id: github-pr-review
title: Two-user PR creation and review flow
category: composition

description: |
  Multi-session composition: Alice creates a PR, Bob reviews it.

  ⚠️ STATUS: Template only - not validated
  Requires two authenticated GitHub accounts to test.

  Demonstrates:
  - Multi-session management
  - Cross-session state (PR number)
  - Role-based workflows

parameters:
  base_url: https://github.com
  repo: owner/repo
  branch: feature-branch

sessions:
  - name: alice
    lifecycle: persistent
    description: PR author
  - name: bob
    lifecycle: persistent
    description: PR reviewer

steps:
  # Alice creates PR
  - desc: Alice navigates to create PR
    session: alice
    commands:
      - agent-browser open {{env.base_url}}/{{env.repo}}/compare/{{env.branch}}
      - agent-browser wait 2000
    expect:
      - element_visible: {{role: button, name: /Create pull request/}}

  - desc: Alice fills PR details
    session: alice
    commands:
      - agent-browser fill {{role: textbox, name: "Title"}} "Add new feature"
      - agent-browser click {{role: button, name: "Create pull request"}}
      - agent-browser wait 3000
    expect:
      - url_contains: /pull/
    extract:
      from: {{role: link, name: /#\d+/}}
      pattern: "#(\\d+)"
      save_as: pr_number

  # Bob reviews
  - desc: Bob opens the PR
    session: bob
    commands:
      - agent-browser open {{env.base_url}}/{{env.repo}}/pull/{{ctx.pr_number}}
      - agent-browser wait 2000
    expect:
      - element_visible: {{role: heading, name: /Add new feature/}}
      - element_visible: {{role: button, name: /Review changes/}}

  - desc: Bob submits review
    session: bob
    commands:
      - agent-browser click {{role: button, name: /Review changes/}}
      - agent-browser wait 1000
      - agent-browser fill {{role: textbox, name: /Leave a comment/}} "LGTM!"
      - agent-browser click {{role: button, name: "Approve"}}
      - agent-browser click {{role: button, name: "Submit review"}}
    expect:
      - element_visible: {{role: heading, name: /approved/i}}

exploration:
  status: draft
  notes: |
    Template for multi-user composition.
    Needs authenticated sessions to validate.
    Left for successor to complete.
