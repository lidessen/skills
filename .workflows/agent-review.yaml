agents:
  reviewer:
    model: deepseek:deepseek-chat
    system_prompt: prompts/reviewer.md

context:
  provider: memory

setup:
  - shell: gh pr view "$PR_NUMBER" --repo "$GITHUB_REPOSITORY" --json title,body,baseRefName,headRefName,author,additions,deletions,changedFiles
    as: pr_info

  - shell: gh pr diff "$PR_NUMBER" --repo "$GITHUB_REPOSITORY"
    as: pr_diff

  - shell: gh pr view "$PR_NUMBER" --repo "$GITHUB_REPOSITORY" --json files --jq '.files[].path'
    as: changed_files

  # Post status comment on PR — agent will edit this with the final review
  - shell: |
      gh api repos/$GITHUB_REPOSITORY/issues/$PR_NUMBER/comments \
        -f body='> ⏳ **Reviewing...**' --jq '.id'
    as: comment_id

kickoff: |
  @reviewer Please review this pull request.

  ## PR Info
  ${{ pr_info }}

  ## Changed Files
  ${{ changed_files }}

  ## Diff
  ${{ pr_diff }}

  When done, write your review to /tmp/review.md, then update the status comment:
  ```
  gh api repos/$GITHUB_REPOSITORY/issues/comments/${{ comment_id }} \
    -X PATCH -F body=@/tmp/review.md
  ```
